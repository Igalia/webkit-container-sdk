#!/usr/bin/env bash
# Copyright 2024 Igalia S.L.
# SPDX-License: MIT

# Standalone helper script to create symlinks for clang tools.
# Used by both the Containerfile and wkdev-setup-clang.

set -euo pipefail

usage() {
    echo "Usage: $(basename "$0") <version> [output_path]"
    echo "  version     - clang version number (e.g., 18)"
    echo "  output_path - directory for symlinks (default: /usr/local/bin)"
    exit 1
}

if [ $# -lt 1 ]; then
    usage
fi

version="$1"
output_path="${2:-/usr/local/bin}"

if [ ! -f "/usr/bin/clang-${version}" ]; then
    echo "Error: clang-${version} is not installed" >&2
    exit 1
fi

mkdir -p "${output_path}"
for binary in /usr/bin/*-"${version}"; do
    binary_name="$(basename "${binary}")"
    ln --symbolic --force "${binary}" "${output_path}/${binary_name::-3}"
done
